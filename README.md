# ESP8266-RaspberryPi-MQTT-NodeRED
ESP8266 MQTT Sensors to Raspberry Pi broker and dashboard using Node-RED

I built a dashboard with a Raspberry Pi to display sensors data. The Raspberry Pi has a screen. The dashboard is powered by Node-RED and displayed on Chromium in Kiosk node.
The Raspberry Pi is setup as a WiFi access point so that the ESP8266 sensors can communicate directly to the Raspberry Pi through WiFi in MQTT.

<img src="https://github.com/DavidPetit/ESP8266-RaspberryPi-MQTT-NodeRED/blob/master/raspberrypi.jpg" width="400">

<img src="https://github.com/DavidPetit/ESP8266-RaspberryPi-MQTT-NodeRED/blob/master/esp8266_sensor.jpg" width="400">

## Requirements

### Hardware
* At least one ESP8266 board (I use Wemos D1 Mini https://wiki.wemos.cc/products:d1:d1_mini)
* At least one sensor connected to ESP8266 board (I use Wemos SHT30 shield https://wiki.wemos.cc/products:d1_mini_shields:sht30_shield)
* One Raspberry Pi (model 3 is prefered https://www.raspberrypi.org/products/raspberry-pi-3-model-b/)
* A LCD screen for the Raspberry Pi (I use a 3.5 Inches LCD touch screen for example https://www.aliexpress.com/item/Best-Price-Original-3-5-LCD-TFT-Touch-Screen-Display-for-Raspberry-Pi-2-Model-B/32508151978.html)
* Micro SD Card for the Raspberry Pi
* A computer to do the setup on Rapsberry Pi and on the ESP8266 boards

### Software
#### For ESP8266 boards
* Program like the .ino file from this repo to flash on ESP8266
#### For Rapsberry Pi
* Raspbian (https://www.raspberrypi.org/downloads/raspbian/)
* MQTT Broker (I use Mosquitto: https://mosquitto.org/download/)
* Node-RED (https://nodered.org/)
* node-red-dashboard (https://github.com/node-red/node-red-dashboard)
#### For developement computer
* Arduino IDE (on computer for ESP8266 development and being able to flash programs on the boards)

## Installation for ESP8266 Sensors

### Hardware
Solder the components.

It is preferable not to connect the SHT30 shield directly on top of the D1 mini because the heat generated by the D1 mini will affect the measured temperature.

I use a triple base (https://wiki.wemos.cc/products:d1_mini_shields:tripler_base) in order to have the wemos mini at one end and the SHT30 at the other end:

<img src="https://github.com/DavidPetit/ESP8266-RaspberryPi-MQTT-NodeRED/blob/master/wemos_sht30_1.jpg" width="400">

<img src="https://github.com/DavidPetit/ESP8266-RaspberryPi-MQTT-NodeRED/blob/master/wemos_sht30_2.jpg" width="400">

To flash the program that will read the data and send with MQTT, connect the D1 mini to the computer through USB.

### Software
1. To install the Wemos D1 mini in board manager in Arduino IDE go to: File, Preferences, Additional boards manager URLs and add this URL: http://arduino.esp8266.com/stable/package_esp8266com_index.json
2. To install the ESP8266 libraries in Arduino IDE go to: Sketch, Include Library, Manage Libraries and type ESP8266 in the text field. Install at least ESP8266 and ESP8266WiFi.
3. Then to install the PubSubClient library, type PubSubClient and install this library.
4. Also install ArduinoJson library
5. Install Wemos SHT3x Arduino library by following the intructions here: https://github.com/wemos/WEMOS_SHT3x_Arduino_Library
6. Copy the content from the file https://github.com/DavidPetit/ESP8266-RaspberryPi-MQTT-NodeRED/blob/master/mqtt-sht30-sensor.ino and customize it based on the needs.


## Installation for Raspberry Pi

### Hardware
My setup looks like this:

<img src="https://github.com/DavidPetit/ESP8266-RaspberryPi-MQTT-NodeRED/blob/master/raspberrypi_screen_1.jpg" width="400">

<img src="https://github.com/DavidPetit/ESP8266-RaspberryPi-MQTT-NodeRED/blob/master/raspberrypi_screen_2.jpg" width="400">

### Software
Follow the instructions to have the Raspberry Pi ready and install the Raspbian distribution with Desktop: 
https://www.raspberrypi.org/documentation/installation/installing-images/README.md

Once your Raspberry pi is ready and running, install a MQTT broker (Mosquitto):
```
sudo apt-get install Mosquitto
```

Install node-RED: https://nodered.org/docs/hardware/raspberrypi

Install node-red-dashboard: https://github.com/node-red/node-red-dashboard

With node-RED, create a flow that will subscribe to the MQTT Broker and display the data on a dashboard.

Set up Chromium as a kiosk : https://github.com/elalemanyo/raspberry-pi-kiosk-screen and set it up to open the URL of node-RED dashboard ``` http://localhost:1880/ui ```


